---
title: AM2301Bã‚’åˆ©ç”¨ã—ã¦æ¸©æ¹¿åº¦ã‚’è¨ˆæ¸¬ã™ã‚‹
thumbnail: /images/am2301b/sensor.JPG
twitter_card: summary_large_image
tags:
  - AM2301B
  - NanoPi
  - æ¸©æ¹¿åº¦
date: 2021-09-20 23:20:36
---

AM2301Bã¨ã„ã†ã‚»ãƒ³ã‚µã‚’è²·ã£ã¦ããŸã®ã§NanoPi NEO2ã§å‹•ã‹ã—ã¦ã¿ã¾ã—ãŸï¼

<!-- more -->

ç§‹æœˆé›»å­: 

[æ¸©æ¹¿åº¦ã‚»ãƒ³ã‚µã€€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€€ï¼¡ï¼­ï¼’ï¼“ï¼ï¼‘ï¼¢: ã‚»ãƒ³ã‚µä¸€èˆ¬ ç§‹æœˆé›»å­é€šå•†-é›»å­éƒ¨å“ãƒ»ãƒãƒƒãƒˆé€šè²©](https://akizukidenshi.com/catalog/g/gM-16730/)

ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆ: [https://akizukidenshi.com/download/ds/aosong/AM2301B.pdf](https://akizukidenshi.com/download/ds/aosong/AM2301B.pdf)

ç”Ÿç”£ã—ã¦ã„ã‚‹ä¼šç¤¾ã®å•†å“ç´¹ä»‹ãƒšãƒ¼ã‚¸: 

[AM2301B Temperature and humidity sensor-RH&T Sensors-Guangzhou Aosong Electronic Co., Ltd.]()

ç²¾åº¦ã¯æ¸©åº¦: Â±0.3â„ƒ, æ¹¿åº¦: Â±2%RH(25â„ƒ) ã§ã™ï¼



## âš™ NanoPiã®è¨­å®š

NanoPiã¨AM2301Bã¯I2Cã§é€šä¿¡ã—ã¾ã™ï¼

ã‚ã‚‰ã‹ã˜ã‚NanoPiå´ã§I2Cã‚’æœ‰åŠ¹åŒ–ã—ã¦ãŠãã¾ã™ï¼NanoPiã§Armbianã‚’å‹•ã‹ã—ã¦ã„ã‚‹ãªã‚‰ï¼Œ

```
$ sudo armbian-config
```

System > Hardware > i2c0 ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§âœ…ã‚’ã„ã‚Œã¾ã™ï¼Enterã§Saveã—ã¾ã™ï¼

![](/images/am2301b/i2c-setting.png)

## ğŸ”Œ NanoPiã¨AM2301Bã‚’ç¹‹ã

![](/images/am2301b/nanopi-pins.png)

å³ä¸Šå†…å´ã®OUT - 3.3Vï¼ŒSDAï¼ŒSCLï¼ŒGNDã‚’åˆ©ç”¨ã—ã¾ã™ï¼

![](/images/am2301b/connect.JPG)



i2c-toolsã§æ­£ã—ãæ¥ç¶šã§ãã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ï¼

```
$ sudo apt-get install i2c-tools
$ sudo i2cdetect -y 0
```

ã§

```
0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- -- 
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
30: -- -- -- -- -- -- -- -- 38 -- -- -- -- -- -- -- 
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
70: -- -- -- -- -- -- -- --
```

ã¨è¿”ã£ã¦ã“ã‚Œã°æˆåŠŸã§ã™ï¼

## âš¡ï¸ Pythonã§é€šä¿¡ã™ã‚‹

smbusã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§I2Cé€šä¿¡ã‚’è¡Œã„ã¾ã™ï¼

```
$ sudo apt-get install python3-smbus
```

é©å½“ã«ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆã‚’èª­ã¿ãªãŒã‚‰ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™ï¼ä»Šå›ã¯CRC checkã«ã¯ç›®ã‚’ç‘ã‚‹ã“ã¨ã¨ã—ã¾ã™ï¼èª¤å·®ã¨ã®å…¼ã­åˆã„ã¯ãŠå¥½ã¿ã§(ã‚‚ã†ã¡ã‚‡ã£ã¨ç´°ã‹ãã¦ã‚‚ã„ã„æ°—ãŒã™ã‚‹)ï¼

```python
import smbus
import time

# i2cãƒã‚¹ã®ç•ªå·
i2c = smbus.SMBus(0)
# ãƒ‡ãƒã‚¤ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹
addr = 0x38

# ãƒ‡ãƒã‚¤ã‚¹ã®çŠ¶æ…‹ç¢ºèª
status = i2c.read_byte_data(addr, 0x71)
if status != 0x18:
    # åˆæœŸåŒ–æŒ‡ç¤º
    i2c.write_i2c_block_data(addr, 0xBE, [0x08, 0x00])

    time.sleep(0.1)

    status = i2c.read_byte_data(addr, 0x71)
    
    if status != 0x18:
        print("Device initialization failed.")
        exit()

# è¨ˆæ¸¬æŒ‡ç¤º
i2c.write_i2c_block_data(addr, 0xAC, [0x33, 0x00])

# è¨ˆæ¸¬ã¾ã§ã¯80msä»¥ä¸ŠãŠãå¿…è¦ãŒã‚ã‚‹ï¼
time.sleep(0.2)

# è¨ˆæ¸¬çŠ¶æ…‹ç¢ºèª
status = i2c.read_byte_data(addr, 0x71)

# statusã®Bit[7]ãŒ0ãªã‚‰è¨ˆæ¸¬å®Œäº†
if format(status, '08b')[0] != "0":
    print("è¨ˆæ¸¬æœªå®Œ")
    exit()

# æ¸¬å®šçµæœã‚’èª­ã¿å–ã‚Š
block = i2c.read_i2c_block_data(addr,0,8)

# èª­ã¿å–ã‚Šçµæœã‹ã‚‰æ¸©åº¦æ¹¿åº¦ã‚’è¨ˆç®—
hum = int(block[1] << 12 | block[2] << 4 | block[3] >> 4) * 100
hum = int(hum >> 20)

temp = int((block[3] & 0b00001111) << 16 | block[4] << 8 | block[5]) * 200
temp = float(temp >> 18) / 4
temp -= 50

print("T:", temp, " H:", hum)

```

ãã‚Œã£ã½ã„å€¤ãŒå–å¾—ã§ãã¾ã—ãŸï¼ã‚ˆã‹ã£ãŸã€œ

![](/images/am2301b-get-value/success.png)

åˆæœŸåŒ–ã®æ–¹æ³•ã¯ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆã«è¼‰ã£ã¦ã„ã¾ã›ã‚“ã§ã—ãŸãŒ[åˆ¥ã®PDF](https://www.aosong.com/userfiles/files/media/AM2301B%E8%8B%B1%E6%96%87%E7%89%88_%E5%8E%BB%E6%BB%A4%E6%B3%A2%20%E4%B8%8A%E6%8B%89.pdf)ã«ã¯æ²è¼‰ã•ã‚Œã¦ã„ã¾ã—ãŸï¼



### InfluxDB + Grafana

InfluxDBã«æŠ•ã’ã¤ã‘ã¦Grafanaã§å¯è¦–åŒ–ã—ãŸã‚‰ã„ã„æ„Ÿã˜ã«ãªã‚Šã¾ã™ï¼

ã‚»ãƒ³ã‚µã®å ´æ‰€ã‚’å›ºå®šã—ã¦ãªã„ãŸã‚ã‹æ€¥ã«å¤‰å‹•ã™ã‚‹æ™‚é–“ãŒç™ºç”Ÿã—ã¦ã¾ã™ã­ãƒ»ãƒ»ãƒ»ï¼

æ§˜å­è¦‹ã—ã¦è¨­ç½®å ´æ‰€ã¨ã‹ç²¾åº¦ã‚’ã©ã“ã¾ã§æ±‚ã‚ã‚‹ã‹ãªã©ã‚’èª¿æ•´ã—ãŸæ–¹ãŒè‰¯ã•ãã†ã§ã™ï¼

![Grafana](/images/am2301b/grafana.png)



### æ„Ÿæƒ³

ç§‹è‘‰åŸã®ç§‹æœˆã«ãµã‚‰ã£ã¨ã‚ˆã£ã¦æ‰‹ã«å–ã£ãŸæ¸©æ¹¿åº¦ã‚»ãƒ³ã‚µã§ã—ãŸãŒç™ºå£²ç›´å¾Œã™ãã¦ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆä»¥å¤–ã®æƒ…å ±ãŒãªãã†ã‚ãŸãˆã¾ã—ãŸï¼(2021.08.31ç™ºå£² / 2021.09.10è³¼å…¥)

I2Cã‚’åˆ©ç”¨ã—ãŸã“ã¨ãŒãªã‹ã£ãŸã®ã§å®Œå…¨ã«æ‰‹æ¢ã‚Šã§ã—ãŸãŒå€¤ãŒå–ã‚Œã¦ã‚ˆã‹ã£ãŸã§ã™ï¼(é–“é•ã£ã¦ãŸã‚‰æŒ‡æ‘˜ã‚’ãŠé¡˜ã„ã—ã¾ã™...)

